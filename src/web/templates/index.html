<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Car Damage Detector â€“ YOLO11 + CarDD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS din static/css/style.css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="page">
    <div class="shell">

        <!-- ğŸ”¹ TOPBAR cu logo + toggle dark/light -->
        <div class="topbar">
            <div class="brand">
                <div class="logo-mark">CD</div>
                <div class="brand-text">
                    <div class="brand-row">
                        <span class="brand-title">CarDamage AI</span>
                        <span class="brand-beta">BETA</span>
                    </div>
                    <span class="brand-subtitle">YOLO11m Â· CarDD</span>
                </div>
            </div>

            <button class="theme-toggle" id="theme-toggle" type="button">
                <span class="theme-toggle-icon" id="theme-toggle-icon">ğŸŒ™</span>
                <span class="theme-toggle-label" id="theme-toggle-label">Dark</span>
            </button>
        </div>

        <header class="header">
            <div class="badge-row">
                <span class="badge"><span class="icon">ğŸš—</span>Computer Vision pentru daune auto</span>
                <span class="badge"><span class="icon">ğŸ§ </span>YOLO11m + CarDD</span>
            </div>
            <h1>Car Damage Detector</h1>
            <p class="subtitle">
                ÃncarcÄƒ o fotografie cu maÈ™ina, iar modelul YOLO11m antrenat pe dataset-ul CarDD Ã®È›i evidenÈ›iazÄƒ
                automat <strong>zgÃ¢rieturi, Ã®ndoiri È™i alte avarii vizibile</strong> pe caroserie.
            </p>
        </header>

        <section class="upload-card" id="upload-card">
            <div class="upload-inner">
                <div class="upload-left">
                    <h2 class="upload-title">ÃncarcÄƒ o imagine pentru analizÄƒ</h2>
                    <p class="upload-desc">
                        AcceptÄƒ formate standard (<code>.jpg</code>, <code>.jpeg</code>, <code>.png</code>).
                        Ideal: o vedere clarÄƒ a zonei avariate.
                    </p>

                    <form method="POST" enctype="multipart/form-data" id="detect-form">
                        <div class="upload-actions">
                            <label class="file-input-wrapper">
                                <span id="file-label">ğŸ“ Alege imaginea</span>
                                <input type="file" name="image" accept="image/*" required id="file-input">
                            </label>
                            <button class="btn" type="submit" id="detect-btn">
                                <span class="btn-spinner" id="btn-spinner"></span>
                                <span id="btn-label">DetecteazÄƒ daune</span>
                            </button>
                        </div>
                    </form>

                    <!-- hint pentru dropzone -->
                    <p class="upload-hint" id="upload-hint">
                        sau trage imaginea direct peste aceastÄƒ zonÄƒ
                    </p>

                    <!-- progress bar YOLO -->
                    <div class="progress-bar" id="progress-bar">
                        <div class="progress-bar-inner"></div>
                    </div>
                </div>

                <aside class="upload-right">
                    <h3>Statistici model</h3>
                    <div class="model-stat-row">
                        <div class="stat-chip">ğŸ“Š <strong>mAP50</strong> â‰ˆ 0.74 (val)</div>
                        <div class="stat-chip">ğŸ–¼ï¸ Train: 2816 imagini</div>
                        <div class="stat-chip">ğŸ§ª Val: 810 &nbsp;|&nbsp; Test: 374</div>
                        <div class="stat-chip">ğŸ·ï¸ Clase: dent, scratch, crack, glass_shatter, lamp_broken, tire_flat</div>
                    </div>
                </aside>
            </div>
        </section>

        {% if original_image %}
        <section class="results-wrapper">
            <div class="results-header">
                <div class="results-title">Rezultatul detecÈ›iei</div>
                <div class="results-subtitle">
                    ComparÄƒ imaginea originalÄƒ cu predicÈ›iile YOLO11m.
                </div>
            </div>

            <div class="images">
                <div class="card fade-in">
                    <h3>
                        Imagine originalÄƒ
                        <span class="card-label">Input</span>
                    </h3>
                    <img src="{{ original_image }}" alt="original"
                         class="result-image" data-animate-image>
                    <p class="legend">
                        Fotografia Ã®ncÄƒrcatÄƒ fÄƒrÄƒ modificÄƒri. Recomandat: luminÄƒ bunÄƒ È™i maÈ™ina sÄƒ ocupe cea mai mare parte din cadru.
                    </p>
                </div>
                <div class="card fade-in delay-1">
                    <h3>
                        Rezultat YOLO11m (daune detectate)
                        <span class="card-label">Output model</span>
                    </h3>
                    <img src="{{ result_image }}" alt="result"
                         class="result-image" data-animate-image>
                    <p class="legend">
                        Zonele Ã®ncadrate indicÄƒ daune detectate: <em>dent</em>, <em>scratch</em>, <em>crack</em>,
                        <em>glass_shatter</em>, <em>lamp_broken</em>, <em>tire_flat</em>.
                    </p>
                </div>
            </div>
        </section>
        {% endif %}

        <footer class="footer">
            <strong>YOLO11m</strong> antrenat pe dataset-ul <strong>CarDD</strong> â€“ demo educaÈ›ional pentru detecÈ›ia
            automatÄƒ a daunelor vizuale ale caroseriei auto.
        </footer>
    </div>
</div>

<script>
    // === DARK / LIGHT THEME TOGGLE ===
    const body = document.body;
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-toggle-icon');
    const themeLabel = document.getElementById('theme-toggle-label');

    function applyTheme(theme) {
        // clasÄƒ pentru tranziÈ›ie smooth Ã®ntre teme
        body.classList.add('theme-transition');
        setTimeout(() => body.classList.remove('theme-transition'), 320);

        if (theme === 'light') {
            body.classList.add('light-theme');
            themeIcon.textContent = 'â˜€ï¸';
            themeLabel.textContent = 'Light';
        } else {
            body.classList.remove('light-theme');
            themeIcon.textContent = 'ğŸŒ™';
            themeLabel.textContent = 'Dark';
        }
    }

    const savedTheme = localStorage.getItem('theme') || 'dark';
    applyTheme(savedTheme);

    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            const newTheme = body.classList.contains('light-theme') ? 'dark' : 'light';
            applyTheme(newTheme);
            localStorage.setItem('theme', newTheme);
        });
    }

    // === ANIMAÈšII LA UPLOAD / SUBMIT + PROGRESS BAR ===
    const form = document.getElementById('detect-form');
    const btn = document.getElementById('detect-btn');
    const btnSpinner = document.getElementById('btn-spinner');
    const btnLabel = document.getElementById('btn-label');
    const uploadCard = document.getElementById('upload-card');
    const fileInput = document.getElementById('file-input');
    const progressBar = document.getElementById('progress-bar');
    const fileLabel = document.getElementById('file-label');
    const uploadHint = document.getElementById('upload-hint');

    function onFileSelected() {
        if (fileInput.files && fileInput.files.length > 0) {
            const file = fileInput.files[0];
            uploadCard.classList.add('file-selected');

            if (fileLabel) {
                fileLabel.textContent = `ğŸ“ ${file.name}`;
            }
            if (uploadHint) {
                uploadHint.textContent = 'FiÈ™ier selectat â€“ apasÄƒ â€DetecteazÄƒ dauneâ€.';
            }
        } else {
            uploadCard.classList.remove('file-selected');
            if (fileLabel) {
                fileLabel.textContent = 'ğŸ“ Alege imaginea';
            }
            if (uploadHint) {
                uploadHint.textContent = 'sau trage imaginea direct peste aceastÄƒ zonÄƒ';
            }
        }
    }

    if (fileInput && uploadCard) {
        fileInput.addEventListener('change', onFileSelected);
    }

    if (form && btn && uploadCard) {
        form.addEventListener('submit', () => {
            btn.disabled = true;
            btn.classList.add('is-loading');
            if (btnSpinner) btnSpinner.style.display = 'inline-block';
            if (btnLabel) btnLabel.textContent = 'Scanningâ€¦';
            uploadCard.classList.add('is-loading'); // pulse glow la upload

            // afiÈ™eazÄƒ progress bar animat
            if (progressBar) {
                progressBar.classList.add('visible');
            }
        });
    }

    // === DROPZONE â€“ drag & drop imagine ===
    if (uploadCard && fileInput) {
        ['dragenter', 'dragover'].forEach(eventName => {
            uploadCard.addEventListener(eventName, (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadCard.classList.add('is-dragover');
            });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadCard.addEventListener(eventName, (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadCard.classList.remove('is-dragover');
            });
        });

        uploadCard.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            if (!dt || !dt.files || dt.files.length === 0) return;

            const file = dt.files[0];
            if (!file.type.startsWith('image/')) return;

            // construim un FileList nou pentru input
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            fileInput.files = dataTransfer.files;

            onFileSelected();
        });
    }

    // === FADE-IN pentru imagini rezultate ===
    const animatedImages = document.querySelectorAll('[data-animate-image]');

    animatedImages.forEach((img) => {
        const show = () => img.classList.add('is-visible');
        if (img.complete) {
            show();
        } else {
            img.addEventListener('load', show, { once: true });
        }
    });
</script>
</body>
</html>

